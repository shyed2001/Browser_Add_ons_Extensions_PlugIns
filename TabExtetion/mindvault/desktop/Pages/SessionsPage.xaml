<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MindVault.Desktop.ViewModels"
             xmlns:m="clr-namespace:MindVault.Desktop.Models"
             x:Class="MindVault.Desktop.Pages.SessionsPage"
             x:DataType="vm:SessionsViewModel"
             Title="{Binding LibraryName}">

    <Grid RowDefinitions="Auto,*,Auto" Padding="16">

        <Label Grid.Row="0"
               Text="{Binding StatusMessage}"
               Style="{StaticResource SubHeadline}"
               Margin="0,0,0,12" />

        <ActivityIndicator Grid.Row="1"
                           IsRunning="{Binding IsLoading}"
                           IsVisible="{Binding IsLoading}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />

        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Sessions}"
                        SelectedItem="{Binding SelectedSession}"
                        SelectionMode="Single"
                        IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                        EmptyView="No sessions found.">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="m:Session">
                    <Frame Margin="0,4" Padding="12" CornerRadius="8" HasShadow="True">
                        <Grid ColumnDefinitions="*,Auto">
                            <StackLayout>
                                <Label Text="{Binding Name}"
                                       FontSize="15" FontAttributes="Bold" />
                                <Label Text="{Binding Notes}"
                                       FontSize="12" TextColor="Gray"
                                       IsVisible="{Binding Notes, Converter={StaticResource StringToBoolConverter}}" />
                            </StackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button Grid.Row="2"
                Text="Open Tabs â†’"
                Margin="0,12,0,0"
                IsEnabled="{Binding SelectedSession, Converter={StaticResource IsNotNullConverter}}"
                Clicked="OnOpenTabsClicked" />
    </Grid>
</ContentPage>
