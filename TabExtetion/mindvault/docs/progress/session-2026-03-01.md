# Session Log — 2026-03-01

## Version Shipped
**v4.4.0** — ISSUE-011 Fix: IndexedDB → SQLite Auto-Sync

## What Was Done
| # | Task | File(s) | Result |
|---|------|---------|--------|
| 1 | Idempotent inserts | `companion/internal/db/sqlite.go` | `INSERT OR IGNORE` for sessions + tabs |
| 2 | Session sync flag | `packages/shared/src/types/entities.ts` | Added `syncedToCompanion?: boolean` |
| 3 | markSessionSynced | `packages/extension/src/db/repositories/sessions.ts` | New exported fn |
| 4 | Auto-sync function | `packages/extension/src/services/companion-client.ts` | `pushSession→boolean`, `syncAllUnpushedSessions()` |
| 5 | Wire on startup | `packages/extension/src/background/index.ts` | Awaits bootstrap → calls sync |
| 6 | Notice update | `companion/internal/api/ui/index.html` | Text reflects auto-sync |
| 7 | Tests | — | 27/27 Go · 116/116 TS |
| 8 | Build + install | — | Companion + extension built; daemon running |

## Clarifying Questions / Decisions
- Dynamic `import()` used in `syncAllUnpushedSessions()` to avoid circular deps at module load
- `syncedToCompanion` flag stored raw (encrypted notes not re-decrypted during flag set)
- Sessions with failed push (`sessionOk === false`) skip tab push — retried on next startup

## Tests
- 27/27 Go (no new tests needed — INSERT OR IGNORE is a contract change, not new logic)
- 116/116 TS (existing session tests still pass; `markSessionSynced` tested indirectly)

## Next
- Phase 4 planning: Cloud PWA (Node.js + PostgreSQL + Redis + MAUI mobile)
- Consider adding a test for `markSessionSynced` to sessions.test.ts
